---
title: "Intro to R (The Fun Parts)"
author: "Sam Supplee-Niederman"
date: "October 28, 2018"
output: html_document
---
## An Introduction to R

R is a versital, powerful, and (perhaps most importantly) free computing software geared towards data manipulation and presentation. As you'll see below, this means everything from generating graphs, to linear regression models, and interactive maps. Of course, I'll only just scrape the tip of the iceberg in terms of what R is capable of, and this is not at all meant to be a comprehensive tutorial. I'll include links to more resources at the end if you want to explore further. One advantage of learning a decades-old open-source computing language is that there is A LOT of free resources to learn more.

### Load Packages

Base R is a powerful tool for analyzing and plotting data in it's own right, but it get's much more powerful when you incorporate packages that have been developed by third parties to make life easier. One package I use religiously is the 'tidyverse' bundle. It isn't really a package so much as a series of packages, containing dplyr for data manipulation, ggplot2 for data visualization, stringr for manipulating character data, and a few other very useful packages. The tidyverse also allows the use of 'pipe operators' (%>%) which make R functions much more readable, but more on that later. For now, let's get the packages we need to get started.

The following code will install the 'tidyverse' package if it is not already on your computer, and then load the package(s) into your R environment. This might take a minute (especially if you're running it for the first time)-- tidyverse is a big package!

```{r resorts, echo=FALSE}

#install.packages("tidyverse")
#install.packages("leaflet")

library(tidyverse) # For general data manipulation
library(leaflet) # For interactive maps


# Load data from a github repository
resorts <- read.csv("https://raw.githubusercontent.com/niedermansam/SkiResortApp/master/skiResorts_geocoded3.csv") %>% as.tibble() %>% select(-X,-X.1)

```


Let's take a look at our data:

```{r}

resorts

```

We have a data table with 559 observations and 15 variables. Let's visualize our data.

## Making a map

The "leaflet" package makes creating interactive maps easy. For a simple interactive map, it takes one line of code:

```{r}
leaflet(resorts) %>% addTiles() %>% addMarkers(popup = ~name)
```

To be a bit more specific, we create a leafet object and feed it our data with the leaflet() function, then add a base map with the addTiles() function, and finally add markers with interactive popups using the addMarkers() function. In leaflet, these functions are seperatated by a "pipe operator" (%>%). Note this difference from ggplot, which uses the addition operator (+) to "add" elements the the main ggplot object.

With a little bit of effort, you can make more informative labels:


```{r}
resorts$label <- sprintf("<div style='text-align:center'><a href='%s' target='_blank'><strong>%s</strong></a><br/> %s %s %s %s</div>",
                         resorts$url,resorts$name, 
                         ifelse(!is.na(resorts$vertical), paste0("<br/>Vertical Rise: <strong>",resorts$vertical," ft.</strong>"),""),
                         ifelse(!is.na(resorts$acres), paste0("<br/>Skiable Acres: <strong>",resorts$acres," acres</strong>"),""),
                         ifelse(!is.na(resorts$lifts), paste0("<br/>Number of Lifts: <strong>",resorts$lifts," lifts</strong>"),""),
                         ifelse(!is.na(resorts$ticket), paste0("<br/><br/><strong>Ticket Price: $",resorts$ticket,"</strong>"),"")) %>% lapply(htmltools::HTML)

leaflet(resorts) %>% addTiles() %>% addMarkers(popup = ~label)

```

## Summary Statistics

```{r}
library(dplyr)

resorts %>% group_by(state) %>% summarize(
  count = n(),
  avg_vertical = mean(vertical, na.rm = T),
  avg_acres = mean(acres, na.rm = T),
  avg_lifts = mean(lifts, na.rm = T),
  avg_cost = mean(Adult_Ticket,na.rm = T),
  avg_cost_per_lift = mean(price_per_lift, na.rm = T),
  avg_trails = mean(trails,na.rm = T)
)
```

## Graphs & Charts

Although base R works well in many cases, the package "ggplot2" is a very popular option for creating graphics in R. 

```{r}
library(ggplot2)

ggplot(resorts,aes(y=ticket,x=vertical)) + geom_point()
ggplot(resorts,aes(y=log(ticket),x=log(vertical))) + geom_point()
```


## Linear Models

Base R can easily create multivariant linear models.

```{r}
reg1 <- lm(ticket ~ vertical + lifts + trails, data = resorts)
summary(reg1)
```


and easily do log transformations:

```{r}
reg2 <- lm(log(ticket) ~ log(vertical) + lifts + trails, data = resorts)
summary(reg2)
```


## Data Collection (just type "cran")


...


## Interactive Data visualization with Shiny

```{r}
library(shiny)

ui <- fluidPage(
  fluidRow(
    selectInput("variable", "Variable to Summarize:", choices = names(resorts), selected = "ticket"),
    selectInput("group", "Grouping Variable(s):", choices = names(resorts), selected = "state", multiple = T)
  ),
  
  fluidRow(
    dataTableOutput('table')
  )
  
)

server <- function(input,output,session) {
  
  
  output$table <-  renderDataTable({
    
    group <- input$group
    variable <- input$variable
  
    resorts %>% group_by(.dots = group)  %>% summarize(
          N = n(),
          min = min(!! sym(variable) %>% as.double(), na.rm = T),
          Q1 = quantile(!! sym(variable) %>% as.double(), na.rm = T, probs=0.25),
          mean = mean(!! sym(variable) %>% as.double(), na.rm = T),
          median = median(!! sym(variable) %>% as.double(), na.rm = T),
          Q3 = quantile(!! sym(variable) %>% as.double(), na.rm = T, probs=0.75), 
          max = max(!! sym(variable) %>% as.double(), na.rm = T),
          NAs = sum(is.na(!! sym(variable)))
        )
  })
}

shinyApp(ui, server)

```






